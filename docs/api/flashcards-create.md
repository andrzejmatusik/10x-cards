# POST /api/flashcards - Create Manual Flashcard

Create a new flashcard manually with custom question and answer content.

## Endpoint

```
POST /api/flashcards
```

## Authentication

**Required**: Yes

Include JWT token in the Authorization header:

```
Authorization: Bearer YOUR_ACCESS_TOKEN
```

## Request

### Headers

| Header | Value | Required |
|--------|-------|----------|
| `Authorization` | `Bearer {token}` | Yes |
| `Content-Type` | `application/json` | Yes |

### Body

```json
{
  "front": "What is the capital of France?",
  "back": "Paris"
}
```

#### Fields

| Field | Type | Required | Constraints | Description |
|-------|------|----------|-------------|-------------|
| `front` | string | Yes | Min: 1 char, Max: 200 chars, Non-whitespace | Question or front side of flashcard |
| `back` | string | Yes | Min: 1 char, Max: 500 chars, Non-whitespace | Answer or back side of flashcard |

## Response

### Success (201 Created)

```json
{
  "id": 124,
  "front": "What is the capital of France?",
  "back": "Paris",
  "source": "manual",
  "created_at": "2025-01-27T11:00:00Z",
  "updated_at": "2025-01-27T11:00:00Z",
  "generation_id": null,
  "user_id": "uuid-here"
}
```

### Error Responses

#### 400 Bad Request - Validation Error

Returned when input validation fails.

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Front text exceeds maximum length of 200 characters",
    "details": {
      "field": "front",
      "message": "Front text exceeds maximum length of 200 characters"
    }
  }
}
```

**Common scenarios:**
- Missing required fields
- Empty or whitespace-only values
- Exceeded maximum length (front: 200, back: 500)
- Invalid JSON format
- Wrong field types

#### 401 Unauthorized

Returned when authentication fails.

```json
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Missing or invalid authentication token"
  }
}
```

**Common scenarios:**
- No Authorization header
- Invalid JWT token
- Expired JWT token
- Malformed token

#### 429 Too Many Requests

Returned when rate limit is exceeded.

```json
{
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Rate limit exceeded. Maximum 100 requests per minute allowed"
  }
}
```

**Headers:**
```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1706356860
```

**Rate Limits:**
- 100 requests per minute per authenticated user
- Applies to all `/api/*` endpoints

#### 500 Internal Server Error

Returned when an unexpected server error occurs.

```json
{
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "An unexpected error occurred while creating flashcard"
  }
}
```

## Examples

### cURL

```bash
curl -X POST https://your-domain.com/api/flashcards \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "front": "What is TypeScript?",
    "back": "A typed superset of JavaScript"
  }'
```

### JavaScript (fetch)

```javascript
const response = await fetch('https://your-domain.com/api/flashcards', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    front: 'What is TypeScript?',
    back: 'A typed superset of JavaScript'
  })
});

if (response.ok) {
  const flashcard = await response.json();
  console.log('Created flashcard:', flashcard);
} else {
  const error = await response.json();
  console.error('Error:', error);
}
```

### TypeScript (with types)

```typescript
import type { CreateFlashcardCommand, FlashcardDTO, ApiErrorResponse } from '@/types';

async function createFlashcard(
  command: CreateFlashcardCommand,
  accessToken: string
): Promise<FlashcardDTO> {
  const response = await fetch('https://your-domain.com/api/flashcards', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(command)
  });

  if (!response.ok) {
    const error: ApiErrorResponse = await response.json();
    throw new Error(error.error.message);
  }

  return response.json();
}

// Usage
try {
  const flashcard = await createFlashcard(
    {
      front: 'What is TypeScript?',
      back: 'A typed superset of JavaScript'
    },
    accessToken
  );
  console.log('Created:', flashcard);
} catch (error) {
  console.error('Failed to create flashcard:', error);
}
```

## Business Logic

### Automatic Fields

The following fields are automatically set by the server:

- `source`: Always set to `"manual"` for this endpoint
- `generation_id`: Always set to `null` (no AI generation)
- `user_id`: Set from authenticated user's JWT token
- `id`: Auto-generated by database (BIGSERIAL)
- `created_at`: Set to current timestamp
- `updated_at`: Set to current timestamp

### Input Sanitization

All input is sanitized to prevent XSS attacks:
- HTML tags are stripped from both `front` and `back` fields
- HTML attributes are removed
- Special characters are preserved for legitimate use

### Row-Level Security (RLS)

Database automatically enforces:
- Users can only create flashcards associated with their own `user_id`
- Users cannot specify a different `user_id` in the request
- RLS policy ensures `user_id = auth.uid()`

## Error Codes Reference

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `VALIDATION_ERROR` | 400 | Input validation failed |
| `UNAUTHORIZED` | 401 | Authentication required or failed |
| `RATE_LIMIT_EXCEEDED` | 429 | Too many requests |
| `INTERNAL_ERROR` | 500 | Unexpected server error |

## Rate Limiting Details

- **Window**: 1 minute (60 seconds)
- **Limit**: 100 requests per user
- **Scope**: Per authenticated user (by user_id)
- **Reset**: Automatic at end of window
- **Headers**: Included in all responses
  - `X-RateLimit-Limit`: Maximum requests allowed
  - `X-RateLimit-Remaining`: Requests remaining in current window
  - `X-RateLimit-Reset`: Unix timestamp when limit resets

### Rate Limit Example

```http
HTTP/1.1 201 Created
Content-Type: application/json
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1706356860

{
  "id": 124,
  "front": "Question",
  "back": "Answer",
  ...
}
```

## Notes

- All timestamps are in ISO 8601 format (UTC)
- Maximum flashcard limits are enforced at validation layer and database level
- Whitespace-only content is rejected (after trimming)
- Special characters and Unicode are supported
- Database trigger automatically updates `updated_at` on modifications
